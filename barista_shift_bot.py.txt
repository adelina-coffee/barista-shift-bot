# barista_shift_bot.py

import asyncio
from aiogram import Bot, Dispatcher
from aiogram.enums import ParseMode
from aiogram.types import ForumTopicClosed
from apscheduler.schedulers.asyncio import AsyncIOScheduler
from datetime import datetime, timedelta
import pytz
import os

TOKEN = os.getenv("TOKEN")
FORUM_TOPIC_IDS = {
    "–æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç": 1,
    "–ù–∞–¥–æ –∑–∞–∫–∞–∑–∞—Ç—å": 2,
}

KALININGRAD_TZ = pytz.timezone("Europe/Kaliningrad")

bot = Bot(token=TOKEN, parse_mode=ParseMode.HTML)
dp = Dispatcher()
scheduler = AsyncIOScheduler(timezone=KALININGRAD_TZ)

async def send_reminder(chat_id: int, topic_id: int, message: str):
    await bot.send_message(chat_id=chat_id, message_thread_id=topic_id, text=message)

def schedule_reminders():
    # –ß–ï–†–ù–ê–Ø –°–†–ï–î–ê
    scheduler.add_job(
        send_reminder,
        trigger='cron',
        day_of_week='wed',
        hour=7, minute=30,
        args=[-1000000000000, FORUM_TOPIC_IDS["–æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç"],
              "@dobro_kld –°–µ–≥–æ–¥–Ω—è –ß–ï–†–ù–ê–Ø –°–†–ï–î–ê ‚òïÔ∏è –£–≥–æ—â–∞–µ–º –Ω–∞—à–∏—Ö –≥–æ—Å—Ç–µ–π –±–µ–∑–ª–∏–º–∏—Ç–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä –∫–æ—Ñ–µ üòÑ"]
    )

    # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞—è–≤–∫–µ –Ω–∞ –∑–∞–∫—É–ø
    scheduler.add_job(
        send_reminder,
        trigger='cron',
        day_of_week='wed,sun',
        hour=8, minute=10,
        args=[-1000000000000, FORUM_TOPIC_IDS["–ù–∞–¥–æ –∑–∞–∫–∞–∑–∞—Ç—å"],
              "‚ÄºÔ∏è –ö–æ—Ç–∏–∫–∏, —Å–µ–≥–æ–¥–Ω—è –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –∫ –∑–∞–∫—É–ø—É! üôå –ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π! :)"]
    )

@dp.startup()
async def on_startup():
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω")
    schedule_reminders()
    scheduler.start()

if __name__ == "__main__":
    asyncio.run(dp.start_polling(bot))